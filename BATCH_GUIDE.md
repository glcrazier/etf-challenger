# ETF批量报告功能使用指南

## 功能概述

ETF批量报告功能可以一键分析配置池中的所有ETF,生成包含买入/卖出建议的综合投资报告。

## 核心特性

- ✅ **批量分析**: 一次性分析多个ETF
- ✅ **智能建议**: 自动给出买入/卖出/持有建议
- ✅ **综合评分**: 多维度评分排名
- ✅ **分类汇总**: 按信号类型分类展示
- ✅ **多格式导出**: 支持Markdown和HTML格式

## 配置ETF池

### 配置文件位置

`etf_pool.json` (项目根目录)

### 配置文件结构

```json
{
  "pools": {
    "宽基指数": {
      "description": "主流宽基指数ETF，适合长期持有",
      "etfs": [
        "510300",  // 沪深300ETF
        "510500",  // 中证500ETF
        "159915",  // 创业板ETF
        "588000",  // 科创50ETF
        "510050",  // 上证50ETF
        "159919"   // 沪深300ETF
      ]
    },
    "行业主题": {
      "description": "热门行业主题ETF，适合主题投资",
      "etfs": [
        "512690",  // 白酒ETF
        "512480",  // 半导体ETF
        "159928",  // 消费ETF
        "512290",  // 医药ETF
        "515880",  // 通信设备ETF
        "512980"   // 传媒ETF
      ]
    }
  },
  "default_pool": "宽基指数"
}
```

### 自定义ETF池

```json
{
  "pools": {
    "我的自选": {
      "description": "我的自选ETF池",
      "etfs": [
        "510300",
        "512880",
        "159915"
      ]
    }
  }
}
```

## 使用方法

### 基本用法

```bash
# 使用默认池生成报告
etf batch

# 指定ETF池
etf batch --pool 行业主题

# 生成HTML报告
etf batch --format html --output report.html

# 自定义分析天数
etf batch --days 90 --pool 宽基指数
```

### 查看可用池

```bash
etf batch --list-pools
```

输出示例:
```
可用的ETF池:

┌──────────┬───────────────────────────────┬─────────┐
│ 池名称   │ 描述                          │ ETF数量 │
├──────────┼───────────────────────────────┼─────────┤
│ 宽基指数 │ 主流宽基指数ETF，适合长期持有 │       6 │
│ 行业主题 │ 热门行业主题ETF，适合主题投资 │       6 │
│ 金融地产 │ 金融和地产行业ETF             │       3 │
└──────────┴───────────────────────────────┴─────────┘
```

### 参数说明

| 参数 | 简写 | 默认值 | 说明 |
|------|------|--------|------|
| --pool | -p | default_pool | ETF池名称 |
| --days | -d | 60 | 分析天数 |
| --output | -o | 自动生成 | 输出文件路径 |
| --format | -f | markdown | 报告格式(markdown/html) |
| --list-pools | - | - | 列出所有可用池 |

## 报告内容

### 执行摘要

```
📋 执行摘要

- 🟢 建议买入: 4只 (66.7%)
- 🔴 建议卖出: 1只 (16.7%)
- 🟡 建议持有: 1只 (16.7%)

最佳标的: 沪深300ETF (510300) - 评分 85.2
最弱标的: 白酒ETF (512690) - 评分 42.8
```

### 买入建议详情

#### 强烈买入

```
#### 沪深300ETF (510300)

- 当前价格: 4.523 (+1.25%)
- 置信度: 78%
- 综合评分: 85.2/100
- 年化收益: +15.3%
- 夏普比率: 1.45
- 目标价位: 4.850 (潜在收益 +7.2%)
- 止损价位: 4.320 (-4.5%)
- 风险等级: 中
- 建议理由:
  - MA5>MA20,短期均线上穿
  - RSI=62,处于健康区间
  - MACD金叉,动能增强
  - 价格站上布林带中轨
```

#### 买入

```
#### 中证500ETF (510500)

- 当前价格: 6.789 (+0.85%)
- 置信度: 65%
- 综合评分: 72.5/100
- 目标价位: 7.120 (+4.9%)
- 建议理由: MA5>MA20,短期均线上穿, RSI=58,处于健康区间, 价格站上布林带中轨
```

### 持有建议

| 代码 | 名称 | 当前价 | 涨跌幅 | 评分 | 年化收益 | 风险 |
|------|------|--------|--------|------|----------|------|
| 159915 | 创业板ETF | 2.345 | +0.50% | 58.2 | +8.5% | 中 |

### 卖出建议

#### 强烈卖出

```
#### 白酒ETF (512690)

- 当前价格: 1.234 (-2.15%)
- 置信度: 72%
- 综合评分: 42.8/100
- 年化收益: -5.2%
- 止损价位: 1.180
- 卖出理由: MA5<MA20,短期均线下穿, RSI=32,超卖区域, MACD死叉
```

### 综合排名

| 排名 | 代码 | 名称 | 评分 | 建议 | 置信度 | 年化收益 | 夏普比率 |
|------|------|------|------|------|--------|----------|----------|
| #1 | 510300 | 沪深300ETF | 85.2 | 强烈买入 | 78% | +15.3% | 1.45 |
| #2 | 510500 | 中证500ETF | 72.5 | 买入 | 65% | +10.2% | 1.12 |
| #3 | 159915 | 创业板ETF | 58.2 | 持有 | 55% | +8.5% | 0.89 |
| #4 | 512690 | 白酒ETF | 42.8 | 强烈卖出 | 72% | -5.2% | -0.35 |

## 评分算法

### 综合评分 (0-100分)

**基础分**: 50分

**信号类型** (40分):
- 强烈买入: +40分
- 买入: +30分
- 持有: 0分
- 卖出: -30分
- 强烈卖出: -40分

**置信度** (20分):
- 每高于50% 5个点,加2分

**年化收益** (20分):
- >20%: +20分
- 10-20%: +15分
- 5-10%: +10分
- 0-5%: +5分
- <0%: -10分

**夏普比率** (20分):
- >2: +20分
- 1-2: +15分
- 0.5-1: +10分
- 0-0.5: +5分
- <0: -10分

**最终分数**: 限制在0-100范围内

### 评分等级

- 90-100分: 优秀 ⭐⭐⭐⭐⭐
- 70-89分: 良好 ⭐⭐⭐⭐
- 50-69分: 中等 ⭐⭐⭐
- 30-49分: 较差 ⭐⭐
- <30分: 很差 ⭐

## 使用场景

### 1. 每周投资复盘

```bash
# 生成宽基指数池的周报
etf batch --pool 宽基指数 --format html --output "周报/$(date +%Y%m%d).html"
```

**使用时机**: 每周末复盘，检视持仓

**关注重点**:
- 新增的买入建议
- 持有标的是否转为卖出
- 评分变化趋势

### 2. 行业轮动决策

```bash
# 对比不同行业的投资机会
etf batch --pool 行业主题 --days 30
```

**使用时机**: 寻找热点行业

**关注重点**:
- 哪些行业ETF评分最高
- 买入信号最强的行业
- 避开卖出信号的行业

### 3. 构建新组合

```bash
# 从多个池中筛选
etf batch --pool 宽基指数 > 宽基.md
etf batch --pool 行业主题 > 行业.md
etf batch --pool 新兴产业 > 新兴.md
```

**使用方法**:
1. 分别生成各池报告
2. 从每个池选出评分最高的1-2只
3. 构建分散化组合

### 4. 定期调仓

```bash
# 每月1号生成报告
etf batch --pool 我的持仓 --format html --output "月报/$(date +%Y%m).html"
```

**操作流程**:
1. 生成月度报告
2. 卖出"强烈卖出"标的
3. 买入"强烈买入"标的
4. "持有"标的保持不动

## 报告示例

### Markdown报告

自动生成文件名: `etf_batch_report_20260201_143000.md`

内容结构:
```markdown
# ETF投资建议报告 - 宽基指数

生成时间: 2026-02-01 14:30:00
分析天数: 60天
ETF数量: 6只

---

## 📋 执行摘要
...

## 🟢 买入建议
...

## 🟡 持有建议
...

## 🔴 卖出建议
...

## 📊 综合排名
...

## ⚠️ 风险提示
...
```

### HTML报告

特点:
- 专业的网页样式
- 渐变色设计
- 可在浏览器中查看
- 适合打印或分享

### 终端摘要

运行命令后会在终端显示摘要:

```
✓ 批量报告已生成: etf_batch_report_20260201_143000.md

📊 报告摘要

ETF池: 宽基指数
分析天数: 60天
成功分析: 6只

🟢 建议买入: 4只
  强烈买入:
    • 沪深300ETF (510300) - 评分 85.2
    • 中证500ETF (510500) - 评分 78.5

🟡 建议持有: 1只

🔴 建议卖出: 1只

🏆 综合评分Top3

1. 沪深300ETF (510300) - 85.2分 - 强烈买入
2. 中证500ETF (510500) - 78.5分 - 买入
3. 创业板ETF (159915) - 58.2分 - 持有
```

## 高级配置

### 批量设置

在配置文件中可以设置批量参数:

```json
{
  "batch_settings": {
    "analysis_days": 60,
    "max_concurrent": 5,
    "include_holdings": false,
    "include_premium": false
  }
}
```

### 多池组合分析

创建一个脚本批量生成多个池的报告:

```bash
#!/bin/bash
# batch_all.sh

pools=("宽基指数" "行业主题" "金融地产" "新兴产业")

for pool in "${pools[@]}"; do
    echo "正在分析: $pool"
    etf batch --pool "$pool" --format html --output "reports/${pool}.html"
done

echo "所有报告生成完成!"
```

## 注意事项

### 1. 数据时效性

- 建议在收盘后使用
- 盘中数据可能不准确
- 数据有1-2分钟延迟

### 2. 建议的使用

- ⚠️ 仅供参考,不构成投资建议
- 需结合基本面分析
- 考虑市场环境和政策
- 评估自身风险承受能力

### 3. 批量分析限制

- 建议每池5-10只ETF
- 太多会影响性能
- 分析时间约1-2分钟/只

### 4. API稳定性

- 数据源可能不稳定
- 失败时稍后重试
- 非交易时间更稳定

## 故障排除

### 问题: 配置文件不存在

**错误**: `配置文件不存在: etf_pool.json`

**解决方案**:
```bash
# 检查文件是否存在
ls etf_pool.json

# 从模板创建
cp etf_pool.json.example etf_pool.json
```

### 问题: 所有ETF分析均失败

**原因**: 数据源不可用

**解决方案**:
1. 稍后重试
2. 检查网络连接
3. 在非交易时间尝试
4. 检查ETF代码是否正确

### 问题: 部分ETF分析失败

**现象**: `成功分析: 4/6只`

**处理**:
- 正常现象,继续使用成功的结果
- 检查失败的ETF代码
- 可以从池中移除失败的代码

## 最佳实践

### 1. 定期生成报告

```bash
# 添加到crontab (每周日20:00)
0 20 * * 0 cd /path/to/etf-challenger && source venv/bin/activate && etf batch --format html --output "周报/$(date +\%Y\%m\%d).html"
```

### 2. 版本控制

```bash
# 将报告加入git忽略
echo "etf_batch_report_*.md" >> .gitignore
echo "etf_batch_report_*.html" >> .gitignore
```

### 3. 分散投资

不要只依赖单一池的建议:
```bash
# 从多个池选择
etf batch --pool 宽基指数 | grep "强烈买入"
etf batch --pool 行业主题 | grep "强烈买入"
```

### 4. 记录决策

为每次操作保留报告:
```bash
mkdir -p investment_log/$(date +%Y%m)
etf batch --format html --output "investment_log/$(date +%Y%m)/$(date +%d).html"
```

## 总结

ETF批量报告功能提供:

✅ **高效**: 一键分析多个ETF
✅ **智能**: 自动生成买卖建议
✅ **全面**: 多维度综合评分
✅ **灵活**: 自定义池和参数
✅ **专业**: 详细的分析报告

**核心价值**:
- 节省时间,批量分析
- 客观评分,辅助决策
- 分类汇总,一目了然
- 定期复盘,优化组合

**使用建议**:
- 每周生成一次报告
- 关注买卖建议的变化
- 结合基本面判断
- 设置止损,控制风险
