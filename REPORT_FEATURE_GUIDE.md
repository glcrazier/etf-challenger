# 分析报告功能演示

## 功能概述

`etf report` 命令可以生成包含所有分析结果的综合报告，支持三种格式：
- **Markdown** (.md) - 纯文本，易于阅读和版本控制
- **HTML** (.html) - 网页格式，美观的可视化展示
- **JSON** (.json) - 结构化数据，方便程序处理

## 快速开始

### 1. 生成基础报告

```bash
# 默认生成Markdown格式
etf report 510300
# 输出: 510300_report_20260201_130935.md
```

### 2. 生成HTML报告

```bash
# 生成可在浏览器查看的HTML报告
etf report 510300 --format html --output 510300.html
```

在浏览器中打开 `510300.html` 即可查看美观的报告。

### 3. 生成JSON报告

```bash
# 生成结构化数据
etf report 510300 --format json --output 510300.json
```

JSON格式适合：
- 导入Excel进行进一步分析
- 存入数据库
- 程序化处理

## 报告内容

### 完整报告包含以下部分：

#### 1. 📊 实时行情
- 最新价、涨跌幅、涨跌额
- 开盘价、最高价、最低价、昨收价
- 成交量、成交额

#### 2. 🎯 交易建议
- 综合建议（强烈买入/买入/持有/卖出/强烈卖出）
- 置信度百分比
- 风险等级
- 分析依据（具体理由）
- 技术指标状态
- 目标价位和止损价位

#### 3. 📈 历史表现
- 总收益率
- 年化收益率
- 年化波动率
- 最大回撤
- 夏普比率
- 交易天数

#### 4. 🔧 技术指标
- MA5、MA20（移动平均线）
- RSI（相对强弱指标）
- MACD、Signal（动能指标）
- BB_Upper、BB_Middle、BB_Lower（布林带）

#### 5. 💎 溢价/折价分析
- 当前溢价率
- 平均溢价率
- 最高/最低溢价率
- 投资提示

#### 6. 📊 持仓分析
- 持仓数量
- 前5大/前10大持仓权重
- 前10大持仓明细（代码、名称、权重）

#### 7. 📅 近期走势
- 最近10个交易日的价格和涨跌幅

## 报告示例

### Markdown报告预览

```markdown
# 华泰柏瑞沪深300ETF (510300) 分析报告

**报告生成时间**: 2026-02-01 13:09:35

---

## 📊 实时行情

- **最新价**: 4.714
- **涨跌幅**: 📉 -1.00%
- **涨跌额**: -0.022
- **成交量**: 0.00
- **成交额**: 0.00

## 🎯 交易建议

### ➡️ 持有

- **置信度**: 50%
- **风险等级**: 低

#### 📝 分析依据

- ✗ 短期均线在长期均线下方，空头排列
- ✗ 处于下降趋势

#### 📈 技术指标状态

| 指标 | 状态 |
|------|------|
| 均线 | 🔴 看跌 |
| RSI | 🟢 看涨 |
| MACD | 🟡 中性 |
...
```

### HTML报告特点

- 📱 响应式设计，自适应各种屏幕
- 🎨 专业的配色和排版
- 📊 表格美化，悬停高亮
- 🖨️ 适合打印或演示

### JSON报告结构

```json
{
  "code": "510300",
  "name": "华泰柏瑞沪深300ETF",
  "report_date": "2026-02-01 13:09:35",
  "quote": {
    "price": 4.714,
    "change_pct": -1.00,
    ...
  },
  "trading_signal": {
    "signal_type": "持有",
    "confidence": 50.0,
    "risk_level": "低",
    ...
  },
  ...
}
```

## 高级用法

### 1. 自定义分析参数

```bash
# 使用90天历史数据，指定2024年持仓
etf report 510300 --days 90 --year 2024 --format html
```

### 2. 批量生成报告

```bash
# 为多个ETF生成报告
for code in 510300 510500 159915; do
    etf report $code --format html --output "${code}.html"
done
```

### 3. 定时生成报告

```bash
# 使用cron每天生成报告
# 在crontab中添加：
0 16 * * 1-5 /path/to/venv/bin/etf report 510300 --format html --output ~/reports/510300_$(date +\%Y\%m\%d).html
```

## 使用场景

### 📝 投资日记
每天收盘后生成报告，记录ETF表现和交易决策

```bash
etf report 510300 --format markdown --output "投资日记/$(date +%Y%m%d)_510300.md"
```

### 📊 周报/月报
定期生成HTML报告，用于复盘和总结

```bash
etf report 510300 --days 30 --format html --output "月报/202401_510300.html"
```

### 💾 数据归档
使用JSON格式保存历史数据，便于后续分析

```bash
etf report 510300 --format json --output "data/510300_$(date +%Y%m%d).json"
```

### 👥 分享分析
生成HTML报告分享给朋友或同事

```bash
etf report 515880 --format html --output "share/通信ETF分析.html"
```

## 报告对比

| 格式 | 文件大小 | 可读性 | 程序处理 | 美观度 | 推荐用途 |
|------|----------|--------|----------|--------|----------|
| Markdown | 小 | ★★★★★ | ★★★☆☆ | ★★★☆☆ | 版本控制、记录 |
| HTML | 中 | ★★★★☆ | ★★☆☆☆ | ★★★★★ | 展示、分享 |
| JSON | 小 | ★★☆☆☆ | ★★★★★ | ★☆☆☆☆ | 数据分析、存储 |

## 注意事项

### 1. 数据源依赖
- 报告质量依赖于数据源的可用性
- 如果数据源不稳定，某些部分可能缺失
- 建议在交易时间外生成报告，减少失败概率

### 2. 文件管理
- 定期清理旧报告，避免占用过多空间
- 使用统一的命名规范，便于查找
- 重要报告及时备份

### 3. 报告解读
- 报告是辅助工具，不是投资建议
- 需结合市场环境和基本面分析
- 定期更新报告，跟踪变化趋势

### 4. 自动化建议
- 使用脚本批量生成多个ETF报告
- 设置定时任务自动生成
- 建立报告归档体系

## 常见问题

**Q: 报告生成失败怎么办？**
A: 通常是网络问题。稍后重试，或检查网络连接。

**Q: 可以修改报告样式吗？**
A: HTML报告的样式在 `analysis/report.py` 的 `_get_html_style()` 方法中定义，可以自定义修改。

**Q: 报告中数据不完整？**
A: 某些数据可能因为：
- 新上市的ETF缺少历史数据
- 数据源暂时不可用
- 指定的年份没有持仓数据

**Q: 如何在程序中处理JSON报告？**
A: 示例代码：
```python
import json

with open('510300_report.json', 'r', encoding='utf-8') as f:
    report = json.load(f)

print(f"交易建议: {report['trading_signal']['signal_type']}")
print(f"置信度: {report['trading_signal']['confidence']}")
```

## 总结

`etf report` 功能特点：
- ✅ 一键生成完整报告
- ✅ 多种格式满足不同需求
- ✅ 整合所有分析结果
- ✅ 自动化友好
- ✅ 专业美观的输出

适合：
- 📊 投资记录和复盘
- 📈 决策依据存档
- 👥 分析结果分享
- 💾 数据归档管理
