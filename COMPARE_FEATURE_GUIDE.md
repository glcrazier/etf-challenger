# ETF批量对比功能使用指南

## 功能概述

ETF批量对比功能可以同时分析多个ETF，并根据多个维度进行对比排名，帮助你快速找到最佳投资标的。

## 使用方法

由于CLI集成的问题，目前使用独立脚本实现批量对比功能：

```bash
# 激活虚拟环境
source venv/bin/activate

# 对比多个ETF（默认表格输出）
python etf_compare.py 510300 510500 159915

# 生成Markdown对比报告
python etf_compare.py 510300 510500 159915 --format markdown --output compare.md

# 生成HTML对比报告
python etf_compare.py 510300 510500 --format html --output compare.html

# 自定义分析天数
python etf_compare.py 510300 510500 159915 --days 90
```

## 对比维度

### 1. 综合评分 (0-100分)

基于以下因素计算：
- **交易信号** (30分) - 买卖建议的权重
- **置信度** (10分) - 信号可靠程度
- **年化收益** (20分) - 历史收益表现
- **夏普比率** (15分) - 风险调整后收益
- **波动率** (15分) - 风险水平
- **最大回撤** (10分) - 下跌风险

### 2. 实时行情

- 最新价格
- 涨跌幅
- 涨跌额

### 3. 交易建议

- 买卖信号（强烈买入/买入/持有/卖出/强烈卖出）
- 置信度百分比
- 风险等级（低/中/高）
- 技术指标分布（看涨/看跌/中性数量）

### 4. 历史表现

- 总收益率
- 年化收益率
- 年化波动率
- 最大回撤
- 夏普比率

## 输出格式

### Table格式（默认）

在终端直接显示美化的对比表格，包含：
- 📊 综合排名
- 📈 实时行情对比
- 📊 历史表现对比
- 💡 推荐建议

### Markdown格式

生成.md文件，包含：
- 完整的对比数据表格
- 综合排名
- 最佳选择推荐
- 最高收益/最低风险/最佳夏普比率推荐

### HTML格式

生成.html文件，特点：
- 专业的网页样式
- 渐变色设计
- 可在浏览器中查看
- 适合打印或分享

## 推荐建议

脚本会自动识别并推荐：

- 🏆 **综合评分最高** - 基于多指标加权评分
- 📈 **最高年化收益** - 收益率最高的ETF
- ⚖️ **最佳夏普比率** - 风险调整后收益最优
- 🛡️ **最低波动率** - 风险最低的ETF

## 使用场景

### 1. 投资组合构建

对比多个候选ETF，选择最优标的：

```bash
# 对比宽基指数ETF
python etf_compare.py 510300 510500 159915 159919

# 对比行业ETF
python etf_compare.py 512690 512480 515880 512980
```

### 2. 定期复盘

每周/每月对比持仓ETF表现：

```bash
# 生成HTML报告归档
python etf_compare.py 510300 510500 --format html --output "复盘/$(date +%Y%m).html"
```

### 3. 行业轮动

对比不同行业ETF，发现轮动机会：

```bash
# 对比科技、消费、医药
python etf_compare.py 512480 159928 512290 --days 30
```

### 4. 分散投资

评估组合中ETF的相关性和风险分散度：

```bash
# 对比全市场ETF
python etf_compare.py 510300 510500 159915 588000
```

## 常见ETF组合

### 宽基指数

```bash
python etf_compare.py 510300 510500 159915 588000
# 510300 - 沪深300
# 510500 - 中证500
# 159915 - 创业板
# 588000 - 科创50
```

### 行业主题

```bash
python etf_compare.py 512690 512480 159928 512290
# 512690 - 白酒
# 512480 - 半导体
# 159928 - 消费
# 512290 - 医药
```

### 策略指数

```bash
python etf_compare.py 512880 510030 512000 515220
# 512880 - 中证红利
# 510030 - 沪深300价值
# 512000 - 券商
# 515220 - 煤炭
```

## 评分说明

### 综合评分计算逻辑

```
基础分：50分

交易信号得分：
- 强烈买入：+30分
- 买入：+20分
- 持有：0分
- 卖出：-20分
- 强烈卖出：-30分

置信度加成：
- 每高于50% 5个点，加1分（最多±10分）

年化收益得分：
- >20%：+20分
- 10-20%：+15分
- 5-10%：+10分
- 0-5%：+5分
- <-5%：-10分

夏普比率得分：
- >2：+15分
- 1-2：+10分
- 0.5-1：+5分
- <0：-5分

波动率得分（风险惩罚）：
- <10%：+15分
- 10-20%：+10分
- 20-30%：+5分
- >30%：-5分

最大回撤得分：
- <5%：+10分
- 5-10%：+5分
- 10-15%：0分
- >15%：-10分

最终得分：限制在0-100范围内
```

### 评分等级

- 90-100分：优秀 ⭐⭐⭐⭐⭐
- 80-89分：良好 ⭐⭐⭐⭐
- 70-79分：中等 ⭐⭐⭐
- 60-69分：一般 ⭐⭐
- <60分：较差 ⭐

## 注意事项

1. **数据源稳定性**
   - akshare数据源可能不稳定
   - 建议在非交易时间使用
   - 失败时稍后重试

2. **分析时效性**
   - 数据有1-2分钟延迟
   - 建议收盘后分析
   - 盘中数据仅供参考

3. **综合判断**
   - 评分仅供参考
   - 需结合基本面分析
   - 考虑市场环境和个人风险承受能力

4. **对比限制**
   - 建议一次对比2-10只ETF
   - 太多会影响性能
   - 太少对比意义不大

## 故障排除

### 问题：所有ETF都获取失败

**原因**：数据源不可用或网络问题

**解决方案**：
1. 稍后重试
2. 检查网络连接
3. 在非交易时间尝试

### 问题：部分ETF获取失败

**原因**：ETF代码错误或数据源部分不可用

**解决方案**：
1. 检查ETF代码是否正确
2. 使用`etf list --keyword 名称`搜索正确代码
3. 移除失败的代码重新运行

### 问题：生成报告失败

**原因**：输出路径不存在或没有权限

**解决方案**：
1. 检查输出路径是否正确
2. 确保有写入权限
3. 使用绝对路径

## 未来改进

- [ ] 添加更多对比维度（费率、规模、跟踪误差等）
- [ ] 支持自定义评分权重
- [ ] 添加相关性分析
- [ ] 支持历史对比（查看排名变化）
- [ ] 添加图表可视化
- [ ] 导出PDF格式

## 示例报告

运行以下命令生成示例报告：

```bash
# 生成HTML报告并在浏览器中打开
python etf_compare.py 510300 510500 159915 --format html --output example.html
open example.html  # macOS
# 或 start example.html  # Windows
# 或 xdg-open example.html  # Linux
```

## 总结

ETF批量对比功能是一个强大的投资决策辅助工具，通过综合多个维度的数据，帮助你快速找到最适合的ETF投资标的。

记住：
- ✅ 使用综合评分快速筛选
- ✅ 关注风险调整后收益（夏普比率）
- ✅ 结合基本面和市场环境
- ✅ 定期更新对比数据
- ❌ 不要仅依赖单一指标
- ❌ 不要忽视风险控制
